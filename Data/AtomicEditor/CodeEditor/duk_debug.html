<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./css/reset.css" type="text/css" />
    <link rel="stylesheet" href="./source/thirdparty/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="./css/duk_debug.css" type="text/css" />
    <title>Duktape debugger</title>
</head>

<body>

    <div id="action-area">
        <button id="stepinto-button">Step&#x00a0;into</button>
        <button id="stepover-button">Step&#x00a0;over</button>
        <button id="stepout-button">Step&#x00a0;out</button>
        <button id="resume-button">Resume</button>
        <button id="pause-button">Pause</button>
        <button id="attach-button">Attach</button>
        <button id="detach-button">Detach</button>
        <button id="about-button">About</button>
        <button id="heap-dump-download-button"><a id="heap-dump-download" href="/heapDump.json" target="_blank">Dump&#x00a0;heap</a></button>
        <button id="show-bytecode-button">Show bytecode</button>
        <div id="exec-state"><span id="current-state">?</span></div>
    </div>

    <div id="part-middle">

        <!--
<div id="left-area">

</div> -->
        <!-- #left-area -->

        <div id="center-area">
            <div id="container"></div>

            <div id="exec-status">
                <div id="exec-other"><span id="current-fileline">?</span></div>
            </div>
            <!-- #exec-status -->
            <div id="output">
                <div style="color: #dddddd">(output from script, print() and alert() calls)</div>
            </div>
        </div>
        <!-- #center-area -->

        <div id="right-area">
            <div id="callstack">
                <div style="color: #dddddd">(callstack)</div>
            </div>
            <div id="locals">
                <div style="color: #dddddd">(locals)</div>
            </div>
            <div id="breakpoints">
                <div style="color: #dddddd">(breakpoints)</div>
            </div>
            <div id="eval">
                <input id="eval-input" value="print('hello world'); 1+2" /><button id="eval-button">Eval</button><input id="eval-watch" type="checkbox" />&#xa0;watch (eval on pause)
                <div id="eval-output"></div>
                <button id="putvar-button">PutVar</button><button id="getvar-button">GetVar</button><input id="varname-input" value="varname" /><input id="varvalue-input" value="varvalue" />
                <div id="var-output"></div>
            </div>
        </div>
        <!-- #right-area -->

    </div>
    <!-- #part-middle -->

    <div id="part-footer">
        <div>DUK_VERSION: <span id="duk-version">?</span>, DUK_GIT_DESCRIBE: <span id="duk-git-describe">?</span>, Target info: <span id="target-info">?</span>, Endianness: <span id="endianness">?</span><br /> Debug protocol stats: recv <span id="debug-rx-bytes">?</span>            (<span id="debug-rx-kbrate">?</span> kB/s), <span id="debug-rx-dvalues">?</span> dvalues, <span id="debug-rx-messages">?</span> messages; send <span id="debug-tx-bytes">?</span> (<span id="debug-tx-kbrate">?</span> kB/s), <span id="debug-tx-dvalues">?</span>            dvalues, <span id="debug-tx-messages">?</span> messages
        </div>
    </div>
    <!-- #part-footer -->

    <div id="about-dialog" title="About Duktape debugger">
        <p>Duktape debugger is a web UI for debugging Ecmascript on a target device.</p>
        <p>This web UI talks to a NodeJS debug server using <a href="http://socket.io/" target="_blank">socket.io</a>. The debug server talks to the target device using the Duktape debug protocol (see
            <a href="https://github.com/svaarala/duktape/blob/master/doc/debugger.rst" target="_blank">debugger.rst</a>).</p>
    </div>
    <!-- #about-dialog -->

    <div id="bytecode-dialog" title="Bytecode for current function">
        <pre id="bytecode-preformatted"></pre>

    </div>

    <script src="./source/thirdparty/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="./source/thirdparty/jquery-ui.min.js" type="text/javascript"></script>
    <script src="./source/thirdparty/socket.io-1.2.0.js" type="text/javascript"></script>

    <script src="./source/systemjs/system.js" type="text/javascript" charset="utf-8"></script>
    <script src="./source/monaco/vs/loader.js"></script>
    <script>
        System.config({
            "baseURL": "./",
            "defaultJSExtensions": true
        });

        // Load up the monaco editor and set it up to be able to be configured
        require.config({
            paths: {
                'vs': 'source/monaco/vs'
            }
        });

        // Need to override how Monaco web workers are getting resolved since for some reason they can't get located properly
        // inside the Monaco editor code
        window.MonacoEnvironment = {
            getWorkerUrl: function(workerId, label) {
                return 'source/monaco/vs/base/worker/' + workerId;
            }
        };

        var setupEditor = new Promise((resolve, reject) => {
            require(['vs/editor/editor.main'], function() {
                //editor = monaco.editor.create(document.getElementById('editor'));
                editor = monaco.editor.create(document.getElementById('container'), {
                    value: [
                        '//No source loaded'
                    ].join('\n'),
                    language: 'javascript',
                    glyphMargin: true
                });

                // Make sure the editor resizes when the window resizes
                window.onresize = () => {
                    editor.layout();
                }

                /*
                                    System.import('./source/editorCore/debugger/webui').then(module => {
                                        console.log("Importing webui");
                                        module.default.initialize(editor);
                                    });
                                    */
                System.import('./source/editorCore/interop').then((module) => {
                    module.default.getInstance().setDebuggerEditor(editor);
                    //module.default.getInstance().editorLoaded();
                    resolve(module.default);
                });
            });
        });

        // Functions exposed to the host editor.  These
        // are hooked in here so that they are available immediately from the host
        // and when called will bring in the interop as a promise and call it once
        // it has been loaded
        function HOST_loadCode(url) {
            setupEditor.then((interop) => {
                //interop.getInstance().loadCode(url);
            });
        }

        function HOST_saveCode() {
            setupEditor.then((interop) => {
                //interop.getInstance().saveCode();
            });
        }

        function HOST_resourceRenamed(path, newPath) {
            setupEditor.then((interop) => {
                //interop.getInstance().resourceRenamed(path, newPath);
            });
        }

        function HOST_resourceDeleted(path) {
            setupEditor.then((interop) => {
                //interop.getInstance().resourceDeleted(path);
            });
        }

        function HOST_preferencesChanged(jsonProjectPrefs, jsonApplicationPrefs) {
            setupEditor.then((interop) => {

                let prefs = {
                    projectPreferences: JSON.parse(jsonProjectPrefs),
                    applicationPreferences: JSON.parse(jsonApplicationPrefs)
                };

                //interop.getInstance().preferencesChanged(prefs);
            });
        }

        function HOST_invokeShortcut(shortcut) {
            setupEditor.then((interop) => {
                //interop.getInstance().invokeShortcut(shortcut);
            });
        }

        function HOST_formatCode() {
            setupEditor.then((interop) => {
                //interop.getInstance().formatCode();
            });
        }

        function HOST_gotoLineNumber(lineNumber) {
            setupEditor.then((interop) => {
                //interop.getInstance().gotoLineNumber(lineNumber);
            });
        }

        function HOST_gotoTokenPos(tokenPosition) {
            setupEditor.then((interop) => {
                //interop.getInstance().gotoPos(tokenPosition);
            });
        }
    </script>
</body>

</html>
